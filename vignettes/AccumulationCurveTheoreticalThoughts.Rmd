---
title: "Accumulation Curve Theoretical Models"
author: "Kassel Hingee"
date: "10/03/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Single Species
Probability of a given species being detected with increasing effort.
Assumptions:
  + detection in each increment of effort ($t$) is independent
  + for one unit of effort the probability of detecting the species is $p$
  
```{r plotincreasedetprob}
library(ggplot2)
pdetect <- function(t, p){
  return(1 - ((1 - p)^t))
}
ggplot() +
  stat_function(aes(x = 1:40),
                fun = function(x) pdetect(x, 0.1)) +
  ggtitle("Detection Probability with Increasing Effort",
          subtitle = "p = 0.1") +
  xlab("Effort") +
  ylab("Detection Probability")
```

## Detected Richness for Independent Species
Assumptions:
  + detection in each increment of effort ($t$) is independent
  + for one unit of effort the probability of detecting species $i$ is $p_i$
  
  
```{r multiplespecies}
p_i <- runif(10)
names(p_i) <- 1:length(p_i)
probscenario <- function(undetsp, p_i){
  p_mod <- p_i
  p_mod[undetsp] <- 1 - p_i[undetsp]
  prob <- Reduce("*", p_mod)
  return(prob)
}
probrichness <- function(p_i, richness){
  undetsp <- combn(names(p_i), length(p_i) - richness, simplify = FALSE)
  prob <- sum(vapply(undetsp, function(x) probscenario(x, p_i), FUN.VALUE = -0.1))
  return(prob)
}
expectedrichness <- function(p_i){
  probrichness_l <- vapply(0:length(p_i), function(r) probrichness(p_i, r), FUN.VALUE = 0.1)
  return(sum(0:length(p_i) * probrichness_l))
}

# calculate for increase time effort
t <- 1 : 40
p_i_t <- lapply(p_i, function(p) pdetect(t, p))
p_i_t <- data.frame(p_i_t)
row.names(p_i_t) <- t
Erich <- apply(p_i_t, 1, expectedrichness) #takes a REAALLY long time for many species

Erich <- data.frame(Erich)
Erich$Effort <- as.numeric(row.names(Erich))
ggplot(data = Erich) +
  geom_point(aes(x = Effort, y = Erich)) +
  ylab("Expected Numbers of Species Detected") +
  ggtitle("Expected Richness")
```


